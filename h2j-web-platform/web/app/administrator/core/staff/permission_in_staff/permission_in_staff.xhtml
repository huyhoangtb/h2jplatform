<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <p:messages  autoUpdate="true"/>
    <p:outputPanel id="searchPanelId" >
        <div class=" UIMarginBottom10px"> 
            <div class="UIFloatLeft UIMarginRight10px UIDivLabel">
                <h:outputLabel value="#{msg['permission_name']}"/>
            </div>
            <div class="UIFloatLeft UIMarginRight10px ">
                <p:inputText  value="#{userController.permissionInData.permissionName}"/>
            </div>

            <div class="UIDivLabel UIFloatLeft UIMarginLeft10px " style="width: 80px">
                <h:outputText value="#{msg['status']}"/>
            </div>
            <div class=" UIFloatLeft UIMarginRight10px">
                <p:selectOneMenu style="width: 130px" value="#{userController.permissionInData.status}" converter="javax.faces.Integer">
                    <f:selectItem itemLabel="#{msg['select_status']}" itemValue="-1"/>
                    <f:selectItems value="#{userController.userPermissionStatus}"/>
                </p:selectOneMenu>
            </div>
            <div class="UIFloatLeft UIMarginRight10px ">
                <p:commandButton  value="#{msg['label_search']}" ajax="false" actionListener="#{userController.searchPermissionInUser}" />    
            </div>
            <div class="UIFloatLeft UIMarginRight10px ">
                <p:commandButton  value="#{msg['role_add_permission_label']}" ajax="true" actionListener ="#{userController.startAddPermissionToUser}" 
                                  oncomplete="PF('addPermissionInhuman').show()"/>    
            </div>
            <div class="UIClearLeft"><span></span></div>
        </div>


        <p:outputPanel styleClass ="UITableControl" id="permissionInRolePanelId">
            <p:contextMenu for="permissionInUserListId">  
                <p:menuitem value="#{msg['label_active']}" icon="ui-icon-unlocked" 
                            actionListener="#{userController.activePermissionInUser}" update="searchPanelId">
                </p:menuitem>  
                <p:menuitem value="#{msg['label_inactive']}" icon="ui-icon-locked" 
                            actionListener="#{userController.inActivePermissionInUser}" update="permissionInUserListId">
                </p:menuitem>  
                <p:menuitem value="#{msg['label_delete']}" icon="ui-icon-trash" 
                            actionListener="#{userController.deletePermissionInUser}" 
                            update="permissionInUserListId">
                </p:menuitem>  
            </p:contextMenu>  

            <p:dataTable  id="permissionInUserListId" var="permissioninUserData" value="#{userController.permissionInUserDataModel}" paginator="true" rows="10"  
                          paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"  
                          rowsPerPageTemplate="5,10,15" selection="#{userController.userPermissionSelection}"  lazy="true" 
                          emptyMessage="Danh sách quyền truy cập rỗng!"  selectionMode="single" paginatorPosition="bottom"
                                          styleClass="UITable UIMarginTop10px">  
                <p:columnGroup type="header">  
                    <p:row>  
                        <p:column rowspan="2" headerText="#{msg['permission_name']}"/>  
                        <p:column rowspan="2"  headerText="#{msg['status']}"/>  
                        <p:column colspan="3" headerText="#{msg['permission_extension_type']}" />  
                    </p:row>  

                    <p:row>  
                        <p:column   headerText="#{msg['permission_view_type']}"/> 
                        <p:column  headerText="#{msg['permission_edit_type']}"/>  
                        <p:column  headerText="#{msg['permission_delete_type']}"/>  
                    </p:row>  
                </p:columnGroup> 

                <p:column  headerText="" sortBy="#{permissioninUserData.permissionName}" width="250">  
                    <h:outputText id="permissionIdOutput" value="#{permissioninUserData.permissionName}" />
                    <p:tooltip for="permissionIdOutput"  
                               showEffect="slide" hideEffect="slide" rendered="#{permissioninUserData.comments ne null}">
                        <h:outputText value="#{permissioninUserData.comments}" escape="false"/>
                    </p:tooltip>  
                </p:column> 

                <p:column width="110">  
                    <h:outputText value="#{permissioninUserData.statusName}" />  
                </p:column> 

                <p:column width="110">  
                    <p:selectBooleanCheckbox value="#{permissioninUserData.allowView}" rendered="#{permissioninUserData.fullControl}"> 
                        <p:ajax process="@this" listener="#{userController.changeExtensionPermissionMode}" />
                        <f:attribute name="permissionUserDto" value="#{permissioninUserData}" />
                    </p:selectBooleanCheckbox> 
                </p:column> 
                <p:column width="110">  
                    <p:selectBooleanCheckbox value="#{permissioninUserData.allowEdit}" rendered="#{permissioninUserData.fullControl}"> 
                        <p:ajax process="@this" listener="#{userController.changeExtensionPermissionMode}" />
                        <f:attribute name="permissionUserDto" value="#{permissioninUserData}" />
                    </p:selectBooleanCheckbox> 
                </p:column> 
                <p:column width="110">  
                    <p:selectBooleanCheckbox value="#{permissioninUserData.allowDelete}" rendered="#{permissioninUserData.fullControl}"> 
                        <p:ajax process="@this" listener="#{userController.changeExtensionPermissionMode}" />
                        <f:attribute name="permissionUserDto" value="#{permissioninUserData}" />
                    </p:selectBooleanCheckbox> 
                </p:column> 
            </p:dataTable>

            <div class="UIClearRight"><span></span></div>
        </p:outputPanel>
    </p:outputPanel>



    <ui:include src="choise_permission_popup.xhtml"/>

</ui:composition>